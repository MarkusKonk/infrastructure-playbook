map $http_upgrade $connection_upgrade {
	default upgrade;
	''      close;
}

server {
	listen 443 ssl default_server;
	listen [::]:443 ssl default_server;

	client_max_body_size 1G; # aka max upload size, defaults to 1M
	client_body_buffer_size 1024m;

	location / {
		# This is the backend to send the requests to.
		proxy_pass http://localhost:8081;
		proxy_set_header Host $http_host;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
		proxy_set_header Upgrade $http_upgrade;

		limit_rate_after 100m;
		limit_rate 5m;
	}

	resolver 8.8.8.8 8.8.4.4 valid=300s;
	resolver_timeout 5s;
	add_header X-Content-Type-Options nosniff;
	add_header X-XSS-Protection "1; mode=block";
	add_header X-Robots-Tag none;
}
